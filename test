/* ==================  ç¬¬äºŒæ­¥ï¼šåªæ‹‰åˆ†ç±»  ================== */
var WidgetMetadata = {
  id: "xtream_step2",
  title: "Xtream Step2",
  description: "ä»…æµ‹è¯•åˆ†ç±»å…¥å£",
  author: "test",
  site: "https://github.com/InchStudio/ForwardWidgets",
  version: "1.0.0",
  requiredVersion: "0.0.1",
  modules: [
    {
      title: "Category Only",
      description: "",
      requiresWebView: false,
      functionName: "getCats",
      cacheDuration: 60,
      params: [
        { name: "host",     type: "input", placeholder: "lot77162.cdngold.me" },
        { name: "username", type: "input" },
        { name: "password", type: "input" }
      ]
    }
  ]
};

/* ä»…è¿”å› 3 æ¡å‡æ•°æ®åˆ†ç±»å¡ç‰‡ */
async function getCats(params) {
  const { host, username, password } = params;
  if (!host || !username || !password) throw new Error("å¿…å¡«å‚æ•°ç¼ºå¤±");

  /* è¿™é‡Œç”¨å›ºå®šå‡æ•°æ®ï¼Œå…ˆä¸çœŸè¯·æ±‚ï¼ŒéªŒè¯ç»“æ„ */
  return [
    {
      id: "cat_live",
      type: "link",
      title: "ğŸ“º Live",
      description: "ç‚¹å‡»æŸ¥çœ‹ Live åˆ—è¡¨",
      posterPath: "https://fakeimg.pl/200x120/1C1C1E/?text=Live",
      link: "js:getStreamsByCat({type:'live',catId:1,host:'" + host + "',username:'" + username + "',password:'" + password + "'})"
    },
    {
      id: "cat_vod",
      type: "link",
      title: "ğŸ¬ VOD",
      description: "ç‚¹å‡»æŸ¥çœ‹ VOD åˆ—è¡¨",
      posterPath: "https://fakeimg.pl/200x120/1C1C1E/?text=VOD",
      link: "js:getStreamsByCat({type:'vod',catId:2,host:'" + host + "',username:'" + username + "',password:'" + password + "'})"
    }
  ];
}

/* äºŒçº§å‡½æ•°ï¼šç›®å‰åªè¿”å› 1 å¼ å‡å¡ç‰‡ */
async function getStreamsByCat(params) {
  return [
    {
      id: "fake_stream",
      type: "url",
      title: "Test Stream",
      description: "æµ‹è¯•æµ",
      posterPath: "https://fakeimg.pl/400x225/1C1C1E/FFFFFF?text=Test",
      backdropPath: "https://fakeimg.pl/400x225/1C1C1E/FFFFFF?text=Test",
      mediaType: "tv",
      videoUrl: "https://sample-videos.com/10/mp4/2.mp4"
    }
  ];
}
